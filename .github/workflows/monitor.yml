name: Instagram Monitor

on:
  schedule:
    - cron: '0 */3 * * *'  # Every 3 hours
  workflow_dispatch:       # Allows manual trigger

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      - name: üßæ Checkout Repository
        uses: actions/checkout@v3

      - name: üêç Set Up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ‚ñ∂Ô∏è Run Instagram Monitor
        env:
          TARGET_USERNAME: ${{ secrets.TARGET_USERNAME }}
          INSTAGRAM_USER: ${{ secrets.INSTAGRAM_USER }}
          INSTAGRAM_PASS: ${{ secrets.INSTAGRAM_PASS }}
          DEBUG_MODE: ${{ secrets.DEBUG_MODE || 'false' }}
        run: |
          echo "üîç Monitoring Instagram user: $TARGET_USERNAME"
          python monitor.py \
            --target-user "$TARGET_USERNAME" \
            --session-user "$INSTAGRAM_USER" \
            --session-pass "$INSTAGRAM_PASS" \
            $([[ "$DEBUG_MODE" == "true" ]] && echo "--debug")

  deploy:
    needs: monitor
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3

      - name: üîß Setup Pages
        uses: actions/configure-pages@v3

      - name: üöÄ Upload Dashboard to GitHub Pages
        uses: actions/upload-pages-artifact@v2
        with:
          path: './'

      - name: ‚úÖ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
