name: Instagram Monitor

on:
  schedule:
    - cron: '0 */3 * * *'  # Runs every 3 hours
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  monitor:
    name: Monitor Instagram Activity
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ”§ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt

      - name: â–¶ï¸ Run Instagram Monitor
        env:
          INSTAGRAM_USER: ${{ secrets.INSTAGRAM_USER }}
          INSTAGRAM_PASS: ${{ secrets.INSTAGRAM_PASS }}
          TARGET_USERNAME: ${{ secrets.TARGET_USERNAME }}
        run: |
          python monitor.py \
            --target-user "$TARGET_USERNAME" \
            --session-user "$INSTAGRAM_USER" \
            --session-pass "$INSTAGRAM_PASS"

  deploy:
    name: ğŸš€ Deploy to GitHub Pages
    needs: monitor
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ“„ Setup Pages
        uses: actions/configure-pages@v3

      - name: ğŸ§¹ Clean existing output
        run: |
          mkdir -p output
          cp -r index.html css js assets data output/

      - name: ğŸ“¤ Upload GitHub Pages artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: ./output

      - name: ğŸš€ Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
